repos:
  # --- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å—Ç–∏–ª—å ---
  - repo: https://github.com/psf/black
    rev: 24.1.0
    hooks:
      - id: black

  - repo: https://github.com/pycqa/flake8
    rev: 7.0.0
    hooks:
      - id: flake8
        args: ["--max-line-length=120"]

  - repo: https://github.com/PyCQA/isort
    rev: 5.13.2
    hooks:
      - id: isort
        args: ["--profile=black"]

  # --- –õ–æ–∫–∞–ª—å–Ω—ã–π —Ö—É–∫: –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ .secrets.baseline ---
  - repo: local
    hooks:
      - id: update-detect-secrets-baseline
        name: üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ detect-secrets baseline
        entry: >
          bash -c '
            echo "üîç –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ .secrets.baseline...";
            files=$(find . -type f \
              -not -path "*/.git/*" \
              -not -path "*/.venv/*" \
              -not -path "*/__pycache__/*" \
              -not -path "*/.mypy_cache/*" \
              -not -path "*/.pytest_cache/*" \
              -not -path "*/.idea/*" \
              -not -name ".secrets.baseline" \
              -not -name ".env" \
              -not -name "poetry.lock");
            detect-secrets scan --disable-filter ALL $files > .secrets.baseline;
            if [ $? -eq 0 ] && [ -s .secrets.baseline ]; then
              echo "‚úÖ Baseline —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω.";
            else
              echo "‚ö†Ô∏è Baseline –ø—É—Å—Ç –∏–ª–∏ –Ω–µ —Å–æ–∑–¥–∞–Ω!";
              exit 1;
            fi
          '
        language: system
        pass_filenames: false

  # --- –ü—Ä–æ–≤–µ—Ä–∫–∞: baseline –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–µ–∫—Ä–µ—Ç—ã ---
  - repo: local
    hooks:
      - id: validate-no-secrets
        name: "‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞: baseline –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–µ–∫—Ä–µ—Ç–æ–≤"
        entry: >
          bash -c '
            if grep -q "hashed_secret" .secrets.baseline; then
              echo "üö® –ù–∞–π–¥–µ–Ω—ã —Å–µ–∫—Ä–µ—Ç—ã –≤ –∫–æ–¥–µ! –£–¥–∞–ª–∏ –∏–ª–∏ –∑–∞–º–∞—Å–∫–∏—Ä—É–π –∏—Ö –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º.";
              echo "üìÑ –°–ø–∏—Å–æ–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤:";
              jq -r "
                .results | to_entries[] |
                \"üìÅ –§–∞–π–ª: \(.key)\" +
                (.value[] |
                  \"  üîê –¢–∏–ø: \(.type)\\n  üìç –°—Ç—Ä–æ–∫–∞: \(.line_number)\\n\"
                )
              " .secrets.baseline;
              exit 1;
            else
              echo \"‚úÖ –°–µ–∫—Ä–µ—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.\";
            fi
          '
        language: system
        pass_filenames: false
        always_run: true

  # --- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤ –ø–æ baseline ---
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.5.0
    hooks:
      - id: detect-secrets
        args:
          - "--baseline"
          - ".secrets.baseline"
          - "--exclude-files"
          - ".*\\.venv/.*|.*__pycache__/.*|.*\\.mypy_cache/.*|.*\\.pytest_cache/.*|.*\\.env"
        always_run: true
        pass_filenames: true

  # --- –¢–∏–ø–∏–∑–∞—Ü–∏—è ---
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.11.2
    hooks:
      - id: mypy

  # --- –û–±—â–∏–µ —Ö—É–∫–∏ ---
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.6.0
    hooks:
      - id: check-yaml
      - id: check-toml
      - id: end-of-file-fixer
      - id: trailing-whitespace
      - id: detect-private-key

  # --- –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã ---
  - repo: local
    hooks:
      - id: pytest
        name: üß™ Pytest before commit
        entry: pytest -q
        language: system
        pass_filenames: false
